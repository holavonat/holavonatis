<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Hol a vonat? - Val√≥s idej≈± vonatk√∂vet√©s Magyarorsz√°gon | Live Train Tracking</title>
  <meta name="description" content="Val√≥s idej≈± vonatk√∂vet√©si t√©rk√©p. N√©zd meg, hol j√°rnak a vonatok most! K√©s√©sek, √∫tvonalak, √°llom√°sok egy helyen. M√ÅV vonatok k√∂vet√©se √©l≈ëben." />
  <meta name="keywords" content="vonat k√∂vet√©s, M√ÅV, vonat t√©rk√©p, vonat k√©s√©s, magyar vonatok, train tracking, vonatmenetrend, vonat helyzet, holavonat" />
  <meta name="author" content="Hol a vonat?" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="Hungarian" />
  
  <meta property="og:title" content="Hol a vonat? - Val√≥s idej≈± vonatk√∂vet√©s Magyarorsz√°gon" />
  <meta property="og:description" content="Val√≥s idej≈± vonatk√∂vet√©si t√©rk√©p. N√©zd meg, hol j√°rnak a vonatok most! K√©s√©sek, √∫tvonalak, √°llom√°sok egy helyen." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://holavonat.is/" />
  <meta property="og:image" content="https://holavonat.is/android-chrome-512x512.png" />
  <meta property="og:image:width" content="512" />
  <meta property="og:image:height" content="512" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content="Hol a vonat?" />
  <meta property="og:locale" content="hu_HU" />
  <meta property="og:site_name" content="Hol a vonat?" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Hol a vonat? - Val√≥s idej≈± vonatk√∂vet√©s" />
  <meta name="twitter:description" content="Val√≥s idej≈± vonatk√∂vet√©si t√©rk√©p. N√©zd meg, hol j√°rnak a vonatok most!" />
  <meta name="twitter:image" content="https://holavonat.is/android-chrome-512x512.png" />
  <meta name="twitter:image:alt" content="Hol a vonat?" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="canonical" href="https://holavonat.is/" />
  <link rel="author" href="/humans.txt" />
  <link rel="sitemap" type="application/xml" href="/sitemap.xml" />
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Hol a vonat?",
    "description": "Val√≥s idej≈± vonatk√∂vet√©si t√©rk√©p. M√ÅV vonatok √©l≈ë k√∂vet√©se, k√©s√©sek, √∫tvonalak.",
    "url": "https://holavonat.is/",
    "applicationCategory": "Transportation",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "HUF"
    },
    "creator": {
      "@type": "Organization",
      "name": "Hol a vonat?",
      "url": "https://holavonat.is/"
    },
    "inLanguage": "hu",
    "audience": {
      "@type": "Audience",
      "geographicArea": {
        "@type": "Country",
        "name": "Hungary"
      }
    }
  }
  </script>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="dns-prefetch" href="//unpkg.com">
  <link rel="dns-prefetch" href="//cdn.holavonat.is">
  <link rel="dns-prefetch" href="//a.tile.openstreetmap.org">
  <link rel="dns-prefetch" href="//b.tile.openstreetmap.org">
  <link rel="dns-prefetch" href="//c.tile.openstreetmap.org">
  <link rel="dns-prefetch" href="//tiles.openrailwaymap.org">
  
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin>
  <link rel="preconnect" href="https://tiles.openrailwaymap.org" crossorigin>
    
  <link rel="prefetch" href="/android-chrome-192x192.png">
  <link rel="prefetch" href="/android-chrome-512x512.png">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    #header {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.85);
      padding: 6px 16px;
      border-radius: 8px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      transition: opacity 1s ease;
      opacity: 1;
      z-index: 1000;
    }
    
    #header h1 {
      margin: 0;
      font-size: inherit;
      font-weight: inherit;
    }
    
    #disclaimer {
      position: absolute;
      bottom: 28px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 12px;
      z-index: 1000;
      color: darkred;
      box-sizing: border-box;
      max-width: 90vw;
      min-width: 180px;
      width: auto;
      word-break: break-word;
    }
    .passed { background-color: #c8e6c9; }
    .delayed { color: red; }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
    }
    td, th {
      padding: 4px 6px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .marker-container {
      position: relative;
      width: 26px;
      height: 26px;
    }

    .triangle-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      width: 26px;
      height: 26px;
      transform-origin: center center;
      z-index: 0;
    }

    .triangle {
      position: absolute;
      top: -8px;
      left: 3px;
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 20px solid black;
    }

    .circle {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: var(--color);
      border: 2px solid black;
      transform-origin: center center;
      border-radius: 50%;
      z-index: 1;
    }

    .popup-table-container {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 5px;
      max-width: 60vw;
    }

    .legend {
      background: rgba(255,255,255,0.7);
      padding: 6px;
      line-height: 18px;
      color: #333;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      border-radius: 5px;
    }

    .legend i {
      padding: 2px;
      width: 12px;
      height: 12px;
      float: left;
      margin-right: 8px;
      border-radius: 50%;
      opacity: 0.8;
    }

    .leaflet-popup-close-button {
      font-size: 32px !important; 
      width: 40px !important;
      height: 40px !important;
      line-height: 40px !important;
      top: 8px !important;
      right: 8px !important;
    }

    @media (max-width: 600px) {
      .leaflet-popup-content {
        max-width: 70vw !important;
        min-width: 0 !important;
        width: 100vw !important;
        max-height: 65vh !important;
        overflow-x: auto !important;
        overflow-y: auto !important;
        font-size: clamp(14px, 4vw, 20px) !important;
        box-sizing: border-box;
        padding: 3vw 2vw 3vw 2vw !important;
      }
      .popup-table-container {
        max-height: 40vh !important;
        overflow-y: auto !important;
        max-width: 98vw !important;
        margin: 0 auto;
        box-sizing: border-box;
      }
      .leaflet-popup-content table {
        font-size: clamp(12px, 3.5vw, 18px) !important;
        min-width: 90vw;
        width: 100%;
        word-break: break-word;
        overflow-x: auto;
        display: block;
      }
      .leaflet-popup-content th,
      .leaflet-popup-content td {
        padding: 2vw 1vw !important;
        font-size: inherit !important;
        white-space: pre-line;
      }
      #disclaimer {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="header">Hol a vonat?</div>
  <div id="map"></div>
  <div id="disclaimer">
    RIP <a href="https://holavonat.hu">holavonat.hu</a><br><br>

    Mirrors: <br>
    <a href="https://holavonat.github.io/instances" target="_blank" rel="noopener">holavonat.github.io/instances</a><br>
    Forr√°sk√≥d: <br>
    <a href="https://github.com/holavonat/holavonatis" target="_blank" rel="noopener">github.com/holavonat/holavonatis</a><br><br>
    Email: <a href="mailto:j@holavonat.is">j@holavonat.is</a>
  </div>
  <div id="stale-warning" style="display:none;position:absolute;top:0;left:0;width:100%;background:rgba(255,0,0,0.85);color:white;text-align:center;padding:10px;z-index:2000;font-size:16px;">
    Figyelem! Az adatok utols√≥ friss√≠t√©se r√©gen volt. Az inform√°ci√≥k elavultak lehetnek.
  </div>

  <script>
    const map = L.map('map', { attributionControl: true }).setView([47.3, 19.1], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a> contributors | ' +
               '<a href="https://www.openrailwaymap.org/" target="_blank" rel="noopener">OpenRailwayMap</a>'
    }).addTo(map);
    L.tileLayer('https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png', {
      maxZoom: 18
    }).addTo(map);

    const legend = L.control({ position: 'bottomright' });

    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML += "<b>Sz√≠nek jelent√©se</b><br>";
      div.innerHTML += '<i style="background: #00e400"></i>0-4 perc k√©s√©s<br>';
      div.innerHTML += '<i style="background: #bfff00"></i>5-14 perc k√©s√©s<br>';
      div.innerHTML += '<i style="background: #ffe600"></i>15-20 perc k√©s√©s<br>';
      div.innerHTML += '<i style="background: #ff9900"></i>21-60 perc k√©s√©s<br>';
      div.innerHTML += '<i style="background: #ff0000"></i>60+ perc k√©s√©s<br>';
      div.innerHTML += '<br><b>Frissitve:</b> <span id="timestamp">...</span><br>';
      return div;
    };

    legend.addTo(map);

    let markers = [];
    let lastEtag = null;
    let lastMetrics = null;
    let routePolyline = null;

    function decodePolyline(encoded) {
      if (!encoded || encoded.length === 0) return [];
      
      const coordinates = [];
      const len = encoded.length;
      let index = 0;
      let lat = 0;
      let lng = 0;
      
      const decodeValue = () => {
        let result = 0;
        let shift = 0;
        let b;
        
        do {
          b = encoded.charCodeAt(index++) - 63;
          result |= (b & 0x1f) << shift;
          shift += 5;
        } while (b >= 0x20 && index < len);
        
        return (result & 1) ? ~(result >> 1) : (result >> 1);
      };
      
      while (index < len) {
        lat += decodeValue();
        lng += decodeValue();        
        coordinates.push([lat * 1e-5, lng * 1e-5]);
      }
      
      return coordinates;
    }

    function delayColor(min) {
      if (min >= 60) return '#ff0000';      
      if (min >= 21) return '#ff9900';
      if (min >= 15) return '#ffe600';
      if (min >= 5)  return '#bfff00'; 
      return '#00e400';
    }

    function createMarkerIcon(color, heading) {
      const container = document.createElement("div");
      container.className = "marker-container";

      const triangleWrapper = document.createElement("div");
      triangleWrapper.className = "triangle-wrapper";
      triangleWrapper.style.transform = `rotate(${heading}deg)`;

      const triangle = document.createElement("div");
      triangle.className = "triangle";

      const circle = document.createElement("div");
      circle.className = "circle";
      circle.style.setProperty('--color', color);

      triangleWrapper.appendChild(triangle);
      container.appendChild(triangleWrapper);
      container.appendChild(circle);

      return L.divIcon({ html: container, className: '', iconSize: [30, 30] });
    }

    function formatTime(sec) {
      if (sec == null) return '-';
      const h = (String(Math.floor(sec / 3600)).padStart(2, '0'))%24;
      const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
      return `${h}:${m}`;
    }

    function getCurrentDelay(stops, now) {
      for (const stop of stops) {
        const arrivalTime = stop.realtimeArrival;
        if (arrivalTime > now) {
          return stop.arrivalDelay || stop.departureDelay || 0; 
        }
      }
      const lastStop = stops[stops.length - 1];
      return lastStop ? (lastStop.arrivalDelay || lastStop.departureDelay || 0) : 0;
    }

    async function getMetrics() {
      try {
        const rnd = Date.now();
        const headResp = await fetch(`https://cdn.holavonat.is/train_data_v3.json?_=${rnd}`, { method: "HEAD" });
         if (!headResp.ok) {
            throw new Error(`HTTP error! status: ${headResp.status}`);
        }

        const etag = headResp.headers.get('ETag');
        if (etag && etag === lastEtag && lastMetrics) {
          return;
        }

        const response = await fetch(`https://cdn.holavonat.is/train_data_v3.json?_=${rnd}`, {});
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        lastEtag = etag;
        lastMetrics = data;
      }
      catch (err) {
        console.error("Hiba t√∂rt√©nt az adatok bet√∂lt√©sekor:", err);
      }
      return lastMetrics;
    }

    async function loadMetrics(metrics) {

      const now = new Date();
      const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
      markers.forEach(m => m.remove());
      markers = [];

      document.getElementById("timestamp").textContent =
        `${new Date(metrics.timestamp).toLocaleTimeString("hu-HU", { timeZone: "Europe/Budapest" })}`;

      var secondsSinceUpdate = (now.getTime() - new Date(metrics.timestamp).getTime()) / 1000;
      const warningDiv = document.getElementById("stale-warning");
      if (secondsSinceUpdate > 60 * 2) {
        warningDiv.style.display = "block";
        warningDiv.textContent = "Figyelem! Az adatok utols√≥ friss√≠t√©se " + new Date(metrics.timestamp).toLocaleTimeString('hu-HU', { timeZone: "Europe/Budapest"}) + "-kor volt! Az inform√°ci√≥k elavultak lehetnek.";
      } else {
        warningDiv.style.display = "none";
      }

      try {
        metrics.vehiclePositions.forEach(vehicle => {
          const delay = Math.round(getCurrentDelay(vehicle.trip.stoptimes, nowSec) / 60);
          const delayText = delay >= 1 ? `${delay} perc k√©s√©s` : 'nincs k√©s√©s';
          const color = delayColor(delay);
          const heading = vehicle.heading || 0;
          const speed = Math.round((vehicle.speed || 0) * 3.6);

          const marker = L.marker([vehicle.lat, vehicle.lon], {
            icon: createMarkerIcon(color, heading)
          }).addTo(map);

          let vehicleName = "";
          let vehicleLogo = "";
          switch (vehicle.trip.route.mode) {
          case "RAIL":
            vehicleName = vehicle.trip.tripShortName || "Ismeretlen vonat";
            vehicleLogo = "üöÑ";
            break;
          case "TRAM":
            vehicleName = vehicle.trip.route.shortName || "Ismeretlen villamos";
            vehicleLogo = "üöã";
            break;
          case "SUBURBAN_RAILWAY":
            vehicleName = vehicle.trip.tripShortName || "Ismeretlen el≈ëv√°rosi vonat";
            vehicleLogo = "üöâ";
            break;
          case "TRAMTRAIN":
            vehicleName = vehicle.trip.tripShortName || "Ismeretlen villamos vonat";
            vehicleLogo = "üöä";
            break;
          default:
            vehicleName = "Ismeretlen j√°rm≈±";
            vehicleLogo = "‚ùì";
            break;
          }

          const id = vehicle.vehicleId.split(":")[1];
          const match = id.match(/^(\d{2})(\d{2})(\d{4})(\d{3})(\d)$/);
          var uic = '';
          if (match) {
            uic = `${match[1]} ${match[2]} ${match[3]} ${match[4]}-${match[5]}`;
          } else {
            uic = id;
          }
 
          marker.bindTooltip(`${vehicleName} (${uic}) (${speed} km/h) - ${delayText}`, {
            direction: "top"
          });

          var routePolyline = null;
          
          marker.on('mouseover', (e) => {
            if (vehicle.trip.tripGeometry && vehicle.trip.tripGeometry.points && !routePolyline) {
              const decodedPoints = decodePolyline(vehicle.trip.tripGeometry.points);
              routePolyline = L.polyline(decodedPoints, {
                color: '#f41804',
                weight: 5,
                opacity: 1,
                lineJoin: 'round'
              }).addTo(map);
            }
          });

          marker.on('mouseout', (e) => {
            if (routePolyline && !marker.isPopupOpen()) {
              routePolyline.remove();
              routePolyline = null;
            }
          });

          let table = '<div class="popup-table-container"><table><tr><th>√Ållom√°s</th><th>√ârk.</th><th>Ind.</th><th>V√°g√°ny</th></tr>';
          vehicle.trip.stoptimes.forEach(stop => {
            const arr = formatTime(stop.scheduledArrival);
            const rta = formatTime(stop.realtimeArrival);
            const dep = formatTime(stop.scheduledDeparture);
            const rtd = formatTime(stop.realtimeDeparture); 
            let track = stop.stop.platformCode
            if (track == null) {
              track = "-";
            }
            const arrDelay = (stop.arrivalDelay || 0) / 60;
            const depDelay = (stop.departureDelay || 0) / 60;
            const delayedClass = (arrDelay > 0 || depDelay > 0) ? 'delayed' : '';
            const isPassed = (stop.realtimeDeparture || 0) < nowSec;

            table += `<tr class="${isPassed ? 'passed' : ''}">
              <td>${stop.stop.name}</td>
              <td>${arr}<br><span class="${delayedClass}">${rta}</span></td>
              <td>${dep}<br><span class="${delayedClass}">${rtd}</span></td>
              <td>${track}</td>
            </tr>`;
          });
          table += '</table></div>';          

          var services = "";
          const serviceDetails = new Map();
          if (vehicle.trip.infoServices != null) {
            vehicle.trip.infoServices.forEach(service => {
              let pictogram = "";
              switch (service.name) {
                case "HungaryPass accepted":
                  service.name = "Orsz√°g B√©rlettel haszn√°lhat√≥";
                  pictogram = "üá≠üá∫";
                  break;
                case "BudapestPass accepted.":
                  service.name = "Budapest B√©rlettel haszn√°lhat√≥";
                  pictogram = "üöá";
                  break;
                case "premium class":
                  service.name = "Pr√©mium oszt√°ly";
                  pictogram = "‚ú®";
                  break;
                case "Second Class":
                  service.name = "M√°sodoszt√°ly";
                  pictogram = "2Ô∏è‚É£";
                  break;
                case "First class in the train":
                  service.name = "Els≈ë oszt√°ly";
                  pictogram = "1Ô∏è‚É£";
                  break;
                case "Seat Reservation compulsory":
                  service.name = "Helyjegy k√∂telez≈ë";
                  pictogram = "üí∫";
                  break;
                case "A wagon suitable for wheelchair travel with a lifting device":
                  service.name = "Mozg√°skorl√°tozottak sz√°m√°ra hozz√°f√©rhet≈ë kocsi emel≈ëvel";
                  pictogram = "‚ôø";
                  break;
                case "A wagon suitable for wheelchair travel without a lifting device":
                  service.name = "Mozg√°skorl√°tozottak sz√°m√°ra hozz√°f√©rhet≈ë kocsi emel≈ë n√©lk√ºl";
                  pictogram = "‚ôø";
                  break;
                case "Bicycle transport is not possible":
                  service.name = "Ker√©kp√°r sz√°ll√≠t√°s nem lehets√©ges";
                  pictogram = "üö≥";
                  break;
                case "Bicycle transport in the designated place. (Limited space, we recommend to notify us in advance of the trip for more than 6 bycicles.)":
                  service.name = "Ker√©kp√°r sz√°ll√≠t√°s a kijel√∂lt helyen. (Korl√°tozott hely, javasoljuk, hogy el≈ëre jelezze az utaz√°st t√∂bb mint 6 ker√©kp√°r eset√©n.)";
                  pictogram = "üö¥";
                  break;
                case "Long distance train":
                  service.name = "Hossz√∫t√°v√∫ vonat";
                  pictogram = "üöÜ";
                  break;
                case "buffet":
                  service.name = "B√ºf√©";
                  pictogram = "‚òï";
                  break;
                case "Domestic travel without reservation on the assigned destination.":
                  service.name = "Belf√∂ldi utaz√°s foglal√°s n√©lk√ºl";
                  pictogram = "üÜì";
                  break;
                case "Train does not wait for connection":
                  service.name = "Vonat nem v√°r csatlakoz√°sra";
                  pictogram = "‚è≥";
                  break;
                case "Suburban train":
                  service.name = "El≈ëv√°rosi vonat";
                  pictogram = "üöâ";
                  break;
                case "Train without a conductor, boarding only with a valid ticket.":
                  service.name = "Vonat kalauz n√©lk√ºl, csak √©rv√©nyes jeggyel lehet felsz√°llni";
                  pictogram = "üö´";
                  break;
                case "Air conditioned vehicle":
                  service.name = "L√©gkondicion√°lt j√°rm≈±";
                  pictogram = "‚ùÑÔ∏è";
                  break;
                case "Bicycles can be transported in wagons marked with a pictogram (up to 4 per wagon).":
                  service.name = "Ker√©kp√°rok sz√°ll√≠t√°sa a jelk√©ppel ell√°tott kocsikban (kocsink√©nt legfeljebb 4 ker√©kp√°r).";
                  pictogram = "üö≤";
                  break;
                case "With designated car for bicycle, suitable also for special bicycles. (For more than 6 bicycles, its recommend to notifying us in advance.)":
                  service.name = "Kijel√∂lt ker√©kp√°rkocsi, amely alkalmas speci√°lis ker√©kp√°rok sz√°m√°ra is. (T√∂bb mint 6 ker√©kp√°r eset√©n javasolt el≈ëre jelezni.)";
                  pictogram = "üö¥";
                  break;
                case "Restaurant car":
                  service.name = "√âtkez≈ëkocsi";
                  pictogram = "üçΩÔ∏è";
                  break;
                case "Direct coach(es)":
                  service.name = "K√∂zvetlen j√°rat";
                  pictogram = "üöå";
                  break;
                case "Bicycles can be transported in the designated place. Booking a bicycle space is mandatory.":
                  service.name = "Ker√©kp√°rok sz√°ll√≠t√°sa a kijel√∂lt helyen. Ker√©kp√°r hely foglal√°sa k√∂telez≈ë.";
                  pictogram = "üö¥";
                  break;
                case "In case of cross border travel international ticket is required for the entire journey.":
                  service.name = "Hat√°ron √°tny√∫l√≥ utaz√°s eset√©n nemzetk√∂zi jegy sz√ºks√©ges az eg√©sz √∫tra.";
                  pictogram = "üåç";
                  break;
                case "Seat reservation can be made":
                  service.name = "Helyjegy foglalhat√≥";
                  pictogram = "ü™ë";
                  break;
                case "In domestic traffic seat Reservation compulsory, seat Reservation in international traffic can be made.":
                  service.name = "Belf√∂ldi forgalomban helyjegy k√∂telez≈ë, nemzetk√∂zi forgalomban helyjegy foglalhat√≥.";
                  pictogram = "üõ§Ô∏è";
                  break;
                case "A cabin or places reserved for disabled person":
                  service.name = "Mozg√°skorl√°tozottak sz√°m√°ra fenntartott f√ºlke vagy helyek";
                  pictogram = "‚ôø";
                  break;
                default:
                  pictogram = "‚ÑπÔ∏è";
                  break;
              }
              serviceDetails.set(service.name, pictogram);
            });
            services = "<br><b>Szolg√°ltat√°s adatok:</b><br>"
            for (const [key, value] of serviceDetails) {
              services += `<span>${value} ${key}</span><br>`;
            }
          }

          marker.bindPopup(`
            <span style="font-size:22px;">${vehicleLogo}</span> <b>${vehicleName}</b><br>
            ${vehicle.trip.tripHeadsign}<br><br>
            <b>J√°rm≈± adatok:</b><br>
            <span title="UIC" style="font-size:18px;">üÜî</span> UIC: ${uic}<br>
            <span title="Mozg√°skorl√°tozottak sz√°m√°ra el√©rhet≈ë" style="font-size:18px;">‚ôø</span> Mozg√°skorl√°tozott felsz√°ll√°s: ${vehicle.trip.wheelchairAccessible == "POSSIBLE" ? 'T√°mogatott' : 'Nem t√°mogatott'}<br>
            <span title="Bicikli sz√°ll√≠t√°s enged√©lyezett" style="font-size:18px;">üö≤</span> Bicikli sz√°ll√≠t√°s: ${vehicle.trip.bikesAllowed == "ALLOWED" ? 'T√°mogatott' : 'Nem t√°mogatott'}<br>
            <span style="font-size:18px;">üí®</span> Sebess√©g: ${speed} km/h<br>
            <span style="font-size:18px;">‚è∞</span> K√©s√©s: ${delayText}<br>
            <span style="font-size:18px;">üóìÔ∏è</span> Utols√≥ friss√≠t√©s: ${new Date(vehicle.lastUpdated * 1000).toLocaleString("hu-HU", { timeZone: "Europe/Budapest" })}<br>
            ${services}
            <br>
            <b>√Ållom√°sok:</b><br>
            ${table}
          `);
          markers.push(marker);
        });
      } catch (err) {
        console.error("Hiba t√∂rt√©nt az adatok bet√∂lt√©sekor:", err);
      }
    }

    function loadData() {
      getMetrics().then(metrics => {
        if (metrics) {
          loadMetrics(metrics);
        }
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const header = document.getElementById('header');
        if (header) header.style.opacity = '0';
      }, 1000);
    });

    loadData();
    setInterval(loadData, 5000);
  </script>
</body>
</html>
